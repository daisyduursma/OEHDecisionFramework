---
title: "Decision framework for selecting management sites for threatened species"
output: flexdashboard::flex_dashboard
runtime: shiny
---

```{r global, include=FALSE}
library(flexdashboard)
library(foreign)
library(leaflet)
library(shiny)
library(Hmisc)
####TO DO ** If this is to be stand alone make sure all packages get installed, i.e rmarkdown
#load species data  ***TO DO - make final data and make seperate folder for data prep
dat.dir<-"/Users/daisy/GoogleDrive/Projects/OEHProtectedSpecies/Data"
sp<-read.csv(paste0(dat.dir,"/SpeciesProfiles/SOSSpeciesList.csv"))#list of species
veg<-unique(sp$Species.type)
veg<-veg[c(1:3,5:7,10,13,15,16)]
florasp<-sp[sp$Species.type %in% veg,]
flora <- read.dbf(paste0(dat.dir,"/SpeciesObservations/Bionet Records/flora/bionet_threatened_flora.dbf"))
flora<-unique(flora[flora$Scientific %in% sp$Scientific.name,])

```

```{r, echo=FALSE}
# global sidebar - sidebar across multiple pages
```

Sidebar {.sidebar} 
=====================================



```{r}
#```{r, echo=FALSE}

 selectInput("species", label = "Select species:",
             choices = sort(sp$Scientific.name), multiple=TRUE, selectize=FALSE, 
             selected = sort(sp$Scientific.name)[1])



```


Species locations
=====================================  

### Locations where species occur

    
```{r,echo=FALSE}

#TO DO - select sites based on species selected - 
# species <- reactive(as.character(input$species)) - # not finding input
# 
# sites<-subset(flora, Scientific == input$species)

#TO DO - add button to zoom to full extent of all observations
#TO DO - add button to interactively add points, unknown if this is possible
#TO DO - fit "." after first item in popup

sites<-subset(flora, Scientific == as.character(florasp$Scientific.name)[10])


# Interactive Map ########################################################################
renderLeaflet({

leaflet() %>%
  addTiles() %>%
  addCircles(sites$Longitude_, sites$Latitude_G, 
             opacity = .7,
             fill = TRUE,
             popup = paste(
                '<strong>Site:</strong>', capitalize(as.character(sites$Descriptio)), '<br>',
                '<strong>Date of last observation:</strong>', sites$DateLast,'<br>',
                '<strong>Number of individuals:</strong>', sites$NumberIndi))%>%
  addMiniMap(tiles = providers$Esri.WorldStreetMap,
             toggleDisplay = TRUE,
             position = "bottomleft")

})


```

   
Environmental Profiles
=====================================     

### Chart 2






